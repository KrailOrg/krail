### Release Notes for krail 0.9.4

This version provides an OptionPopup and integration of Option setting with Shiro access control.
Notifications and Push messages are now handled via the Event Bus.  The first 4 sections of the Tutorial have been written and reviewed.

#### Change log

-   [292](https://github.com/davidsowerby/krail/issues/292): Modify page contributions
-   [358](https://github.com/davidsowerby/krail/issues/358): DefaultOptionCache.write does not update the cache
-   [363](https://github.com/davidsowerby/krail/issues/363): Push handler to use EventBus
-   [393](https://github.com/davidsowerby/krail/issues/393): NPE on log out
-   [396](https://github.com/davidsowerby/krail/issues/396): BasicForest replaceNode not nesting correctly
-   [399](https://github.com/davidsowerby/krail/issues/399): Remove default "nullkey" from Caption et al
-   [401](https://github.com/davidsowerby/krail/issues/401): Option popup
-   [402](https://github.com/davidsowerby/krail/issues/402): User Notifications to use EventBus
-   [407](https://github.com/davidsowerby/krail/issues/407): AuthorisationException should be caught
-   [408](https://github.com/davidsowerby/krail/issues/408): SubjectIdentifier.userId() throws NPE when not logged in?


#### Dependency changes

   test compile dependency version changed to: q3c-testUtil:0.7.10
   test compile dependency version changed to: krail-testUtil:1.0.13

#### Detail

*Version info updated*


---
*Minor amendments to Tutorial*


---
*Fix [401](https://github.com/davidsowerby/krail/issues/401) OptionPopup completed, with user access control integration*

The OptionPopup reads an OptionContext for OptionKeys, creates an editor for them dynamically, and allows the user to change the option values. DefaultRealm gives permission for a user to modify their own options only.
The popup includes 'restore to default' buttons.  These delete the user level option entry, thus defaulting to next highest ranked entry.
Removed unnecessary calls with UserHierarchy as a parameter.  These are no longer required, as the hierarchy is injected into the Option implementation.
The DefaultRealm also now has an 'admin' user, which can modify any user options.  DefaultOption checks for permission on write and delete.  There is no restriction on reading options.

Fix [407](https://github.com/davidsowerby/krail/issues/407)  An AuthorizationException is now caught and handled via a user notification - although actually the "bug" was caused by throwing the wrong exception in DefaultOption - that has been corrected an now throws an UnauthorizedException.  The DefaultLoginView is modified to throw an exception specifcally for empty username or password, and this has also been added to the DefaultExceptionHandler.

Fix [408](https://github.com/davidsowerby/krail/issues/408)  SubjectIdentifier now returns a "?" when no userId is present


---
*Javadoc of UserHierarchy*


---
*See [401](https://github.com/davidsowerby/krail/issues/401) Options Popup available*

OptionPopupWindow provides the user with a way to change their options.  Content is generated by reflection from the OptionConext.  OptionKey is generified, and the default value provided as part of the key.  Fix [358](https://github.com/davidsowerby/krail/issues/358) OptionCache fixed - it was not handling writes correctly.  OptionCacheKey modified to always include the userId as part of that fix.

OptionPopup still to be integrated with User Access Control


---
*Tutorial 04 completed - User Notifications*


---
*Fix [363](https://github.com/davidsowerby/krail/issues/363) Push message handling uses Event Bus*

The PushMessageRouter now uses the Event Bus (@UIBus) to despatch messages received from the Broadcaster.  Both are now interfaces, with default implementations


---
*Fix [399](https://github.com/davidsowerby/krail/issues/399) Remove nullkey from Caption et al*

Removed from all I18NKeys, and values set where required


---
*Fix [402](https://github.com/davidsowerby/krail/issues/402) User notifications via Event Bus*

Overall functionality is the same, but implementation is now simpler.  There are currently no configuration options however, except to exclude the MessageBar and/or  VaadinNotification from the UI.  Options have been deferred to [403](https://github.com/davidsowerby/krail/issues/403)


---
*Tutorial 03 completed - UI & Themes*


---
*Tutorial updates*


---
*Fluent init calls for DefaultUIModule*

See [374](https://github.com/davidsowerby/krail/issues/374).  Remove the end for sub-classing DefaultUIModule just to set the UI class and application name.  Both can now be done in the Binding Manager by:

 - new DefaultUIModule().applicationTitleKey(key).uiClass(clazz)


---
*Tutorial "Pages & Navigation" complete except for workaround for [400](https://github.com/davidsowerby/krail/issues/400)*


---
*Fix [292](https://github.com/davidsowerby/krail/issues/292) Modify page contributions*

DirectSitemapModule has rootURI() method to enable setting the place in the sitemap where the pages should go - this can be configured as part of the construction of the module,  new SystemAdminPages().rootUrl("newurl")


---
*See [398](https://github.com/davidsowerby/krail/issues/398) Null handling for sitemap report*

Handled nulls for module names and annotation sources


---
*Tutorial and Dev Guide updates*

Pages for all the currently planned Tutorial pages added.  Tutorial goes as far as adding pages


---
*See [398](https://github.com/davidsowerby/krail/issues/398) Improve site build debugging*

 Made the Sitemap build report available in log output and in embryonic System Administration pages.  Sitemap loaders now provide more information in the report when the build is successful.  DefaultRealm updated so that these pages are visible once logged in


---
*Grid3x3ViewBase added*

A convenience KrailView class with a 3x3 grid


---
*Fix [396](https://github.com/davidsowerby/krail/issues/396) BasicForest replaceNode() method*

The Jung graph that BasicForest is based on ensures that integrity is maintained at all times - the down side to that is it makes it hard to move a node from part of the graph to another, which BasicForest was previously doing incorrectly.  The method now used takes a sub-graph onto the replacement node, and then copies the sub-graph back into the main graph.  This could have some performance issues for a large site, see [397](https://github.com/davidsowerby/krail/issues/397)

SitemapChecker has been renamed, as it does actually makes changes to the MasterSitemap, and the name suggested something entirely passive.  It is now SitemapFinisher


---
*Added Configuration Section to the Tutorial.  Referenced the Tutorial from the Readme*


---
*Tutorial, second image*


---
*Tutorial - completed "explore basic app"*


---
*Fix [393](https://github.com/davidsowerby/krail/issues/393) NPE on logout*

There was a debug statement using navigator.getCurrentNode(), which can be null if a a page has already been taken out of a user's authorised pages.  The debug can be useful, so just surrounded with  if null ...


---
*Tutorial - fixed image*


---
*Tutorial completed the point where the basic application will run.  Includes a workaround for the Vaadin plugin version issue, and copying of themes.*


---
*Merge pull request [392](https://github.com/davidsowerby/krail/issues/392) from Odhrean/patch-1*

Update tutorial00.md

---
*Merge pull request [1](https://github.com/davidsowerby/krail/issues/1) from Odhrean/Odhrean-patch-1*

Update tutorial00.md

---
*Update tutorial00.md*

the intellij gradle tool had problems to auto-import the dependency

---
*Update tutorial00.md*

added plugin-requirements in build.gradle and the missing step to generate the mentioned *.ipr file

---
*Tutorial Documentation*


---
*Documentation*


---
